---
- name: Установка и настройка Alfresco Communitu
  hosts: virtual
  become: yes

  vars:
    alf_home: /opt/alfresco-community
    alf_data_home: $ALF_HOME/alf_data
    catalina_home: $ALF_HOME/tomcat
    admin_pass: Admin
    obraz: /opt/alfresco-community-installer-201605-linux-x64.bin
    uninstall: /opt/alfresco-community/uninstall

  tasks:
  - name: Установка менеджера пакетов homebrew
    shell: /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
    when: ansible_distribution == "MacOSX"

  - name: Установка wget для загрузки образа Alfresco
    homebrew: name=wget
    when: ansible_distribution == "MacOSX"
    become: no

  - name: Установка wget для загрузки образа Alfresco
    apt:
      name: wget
    when: ansible_distribution == "Ubuntu"
    become: yes

  - name: Проверка существования образа
    stat: path={{ obraz }}
    register: stat_obraz

  - name: Загрузка образа Alfresco
    shell: wget -O {{ obraz }} http://dl.alfresco.com/release/community/201605-build-00010/alfresco-community-installer-201605-linux-x64.bin
    when: stat_obraz.stat.exists == False

  - name: Создание папки для установки
    file:
      path=/opt/alfresco-community
      state=directory

  - name: Права на выполнение
    shell: chmod +x {{ obraz }}

  - name: Install alfresco
    shell: "{{ obraz }} --mode unattended --prefix {{ alf_home }} --alfresco_admin_password {{ admin_pass }}"
    when: uninstall_result.stat.exists == false

  - name: Tomcat status
    


  - name: Tomcat stop
    shell: ./opt/alfresco-community/alfresco.sh stop tomcat
    when: f
